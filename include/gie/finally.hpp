//================================================================================================================================================
// FILE: finally.h
// (c) GIE 2017-07-31  21:20
//
//================================================================================================================================================
#ifndef H_GUARD_FINALLY_2017_07_31_21_20
#define H_GUARD_FINALLY_2017_07_31_21_20
//================================================================================================================================================
#pragma once
//================================================================================================================================================
namespace gie {

    template <typename Fun, typename FinallyFun>
    auto with_finally(Fun&& fun, FinallyFun&& finally_fun){
        try {
            auto r = fun();

            finally_fun();

            return r;
        } catch (...) {
            finally_fun();
            throw;
        }
    };

}
//================================================================================================================================================
#endif
//================================================================================================================================================
